<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;700&family=Open+Sans:wght@400;700&display=swap" rel="stylesheet">
    <title>Faculty Dashboard | Pedro Guevara Elementary School E-Library</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Fredoka', Arial, sans-serif; min-height: 100vh; display: flex; flex-direction: column; background: #f8f9fa; }
        header { background: linear-gradient(135deg, #4a5f9d 0%, #6b82c5 100%); color: white; padding: 0 20px; display: flex; align-items: center; gap: 16px; height: 144px; }
        .logo img { width: 180px; height: 150px; border-radius: 100%; box-shadow: 0 4px 24px rgba(74,95,157,0.18); object-fit: cover; outline: 6px solid #4a5f9d; outline-offset: 2px; cursor: pointer; transition: transform 0.3s ease; }
        .header-text { display: flex; flex-direction: column; justify-content: center; margin-left: 5px; }
        .header-text h1 { font-size: 18px; font-weight: normal; margin-bottom: 8px; margin-left: -29px; font-family: 'Open Sans', Arial, sans-serif; }
        .header-text h2 { font-size: 29px; font-weight: bold; margin-bottom: 8px; margin-left: -29px; font-family: 'Open Sans', Arial, sans-serif; }
        .header-text p { font-size: 18px; margin-left: -29px; font-family: 'Open Sans', Arial, sans-serif; }
        nav { background: white; padding: 0 20px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); position: relative; }
        nav ul { list-style: none; display: flex; gap: 24px; align-items: center; }
        nav li { position: relative; }
        nav a { display: block; padding: 14px 0; color: #333; text-decoration: none; font-weight: 600; font-size: 14px; transition: color 0.3s ease; position: relative; font-family: 'Open Sans', Arial, sans-serif; cursor: pointer; }
        nav a:hover { color: #4a5f9d; }
        nav a::after { content: ''; position: absolute; bottom: 0; left: 0; width: 0; height: 3px; background: #4a5f9d; transition: width 0.3s ease; }
        nav a:hover::after { width: 100%; }
        .dropdown { position: relative; }
        .dropdown-toggle { display: flex; align-items: center; gap: 6px; }
        .dropdown-toggle .arrow { font-size: 10px; transition: transform 0.3s ease; }
        .dropdown.active .arrow { transform: rotate(180deg); }
        .dropdown-menu { display: none; position: absolute; top: 100%; left: 0; background: white; box-shadow: 0 4px 12px rgba(0,0,0,0.15); border-radius: 8px; min-width: 180px; z-index: 1000; margin-top: 8px; }
        .dropdown-menu.show { display: block; animation: fadeIn 0.2s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
        .dropdown-menu a { padding: 12px 20px; display: block; color: #333; font-size: 14px; transition: background 0.2s; }
        .dropdown-menu a:hover { background: #f0f4ff; color: #4a5f9d; }
        .dropdown-menu a::after { display: none; }
        .logout-btn { background: #4a5f9d; color: white; padding: 8px 20px; border-radius: 20px; font-weight: 600; font-size: 14px; border: none; cursor: pointer; transition: all 0.3s ease; font-family: 'Open Sans', Arial, sans-serif; }
        .logout-btn:hover { background: #6b82c5; transform: translateY(-2px); }
        .search-form { display: flex; align-items: center; gap: 8px; }
        .search-input { padding: 8px 16px; border-radius: 20px; border: 1px solid #ccc; font-size: 14px; font-family: 'Open Sans', Arial, sans-serif; outline: none; transition: border-color 0.3s ease; }
        .search-input:focus { border-color: #4a5f9d; }
        .search-btn { padding: 8px 20px; border-radius: 20px; background: #4a5f9d; color: white; border: none; font-weight: 600; cursor: pointer; transition: background 0.3s ease, transform 0.2s ease; font-family: 'Open Sans', Arial, sans-serif; }
        .search-btn:hover { background: #6b82c5; transform: translateY(-2px); }
        main { flex: 1; padding: 40px 20px; max-width: 1200px; margin: 0 auto; width: 100%; }
        .faculty-profile { display: flex; align-items: center; justify-content: space-between; background: white; padding: 32px; border-radius: 20px; box-shadow: 0 2px 12px rgba(74,95,157,0.12); margin-bottom: 32px; }
        .profile-left { display: flex; align-items: center; gap: 24px; }
        .faculty-avatar { width: 80px; height: 80px; border-radius: 50%; background: linear-gradient(135deg, #4a5f9d 0%, #6b82c5 100%); display: flex; align-items: center; justify-content: center; color: white; font-size: 2rem; font-weight: 700; box-shadow: 0 4px 12px rgba(74,95,157,0.2); }
        .faculty-info h2 { font-size: 2rem; font-weight: 700; color: #4a5f9d; margin-bottom: 8px; font-family: 'Fredoka', Arial, sans-serif; }
        .faculty-info p { font-size: 1.1rem; color: #555; font-family: 'Open Sans', Arial, sans-serif; }
        .profile-actions { display: flex; gap: 12px; align-items: center; }
        .edit-info-btn { background: #3498db; color: white; padding: 10px 24px; border-radius: 10px; font-weight: 600; font-size: 14px; border: none; cursor: pointer; transition: all 0.3s ease; font-family: 'Open Sans', Arial, sans-serif; }
        .edit-info-btn:hover { background: #2980b9; transform: translateY(-2px); }
        .greeting-message { font-size: 1.4rem; color: #4a5f9d; font-weight: 600; font-family: 'Fredoka', Arial, sans-serif; }
        .dashboard-actions { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 24px; margin-bottom: 40px; }
        .action-card { background: white; padding: 28px; border-radius: 16px; box-shadow: 0 2px 12px rgba(74,95,157,0.1); text-align: center; cursor: pointer; transition: all 0.3s ease; border: 2px solid transparent; }
        .action-card:hover { transform: translateY(-6px); box-shadow: 0 8px 24px rgba(74,95,157,0.18); border-color: #4a5f9d; }
        .action-card svg { width: 64px; height: 64px; margin-bottom: 16px; fill: #4a5f9d; }
        .action-card h3 { font-size: 1.3rem; color: #4a5f9d; margin-bottom: 8px; font-family: 'Fredoka', Arial, sans-serif; }
        .action-card p { font-size: 0.95rem; color: #666; font-family: 'Open Sans', Arial, sans-serif; }
        .modal { display: none; position: fixed; z-index: 2000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.7); }
        .modal.active { display: flex; align-items: center; justify-content: center; animation: fadeInModal 0.3s; }
        @keyframes fadeInModal { from { opacity: 0; } to { opacity: 1; } }
        .modal-content { background: white; border-radius: 20px; width: 90%; max-width: 600px; max-height: 90vh; overflow-y: auto; animation: slideUp 0.4s; box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3); }
        @keyframes slideUp { from { transform: translateY(50px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        .modal-header { padding: 30px; border-bottom: 2px solid #e8f0ff; display: flex; justify-content: space-between; align-items: center; background: linear-gradient(135deg, #f8faff 0%, #ffffff 100%); }
        .modal-header h2 { font-family: 'Fredoka', sans-serif; color: #4a5f9d; font-size: 1.8rem; margin: 0; }
        .close-btn { background: none; border: none; font-size: 2.5rem; color: #999; cursor: pointer; line-height: 1; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; border-radius: 50%; transition: all 0.3s; }
        .close-btn:hover { color: #333; background: #f0f0f0; }
        .modal-body { padding: 30px; }
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; font-weight: 600; color: #4a5f9d; margin-bottom: 8px; font-size: 14px; font-family: 'Open Sans', Arial, sans-serif; }
        .form-group input, .form-group select { width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 10px; font-size: 14px; font-family: 'Open Sans', Arial, sans-serif; outline: none; transition: border-color 0.3s; }
        .form-group input:focus, .form-group select:focus { border-color: #4a5f9d; }
        .form-group input:disabled { background: #f5f5f5; cursor: not-allowed; }
        .form-note { font-size: 12px; color: #666; margin-top: 4px; font-style: italic; }
        .modal-actions { padding: 25px 30px; border-top: 2px solid #e8f0ff; display: flex; gap: 15px; background: #f8faff; }
        .btn-save { background: #27ae60; color: white; padding: 14px 30px; border: none; border-radius: 10px; font-weight: 600; cursor: pointer; transition: all 0.3s ease; flex: 1; font-family: 'Open Sans', Arial, sans-serif; }
        .btn-save:hover { background: #229954; transform: translateY(-2px); }
        .btn-cancel { background: #95a5a6; color: white; padding: 14px 30px; border: none; border-radius: 10px; font-weight: 600; cursor: pointer; transition: all 0.3s ease; flex: 1; font-family: 'Open Sans', Arial, sans-serif; }
        .btn-cancel:hover { background: #7f8c8d; }
        footer { background: linear-gradient(135deg, #4a5f9d 0%, #6b82c5 100%); color: white; padding: 12px 20px; display: flex; justify-content: space-between; align-items: center; font-family: 'Open Sans', Arial, sans-serif; }
        .footer-links { display: flex; gap: 1px; font-family: 'Open Sans', Arial, sans-serif; justify-content: flex-start; margin-left: 10px; }
        .footer-links a { color: white; text-decoration: none; margin-right: 139px; font-size: 14px; transition: opacity 0.3s ease; font-family: 'Open Sans', Arial, sans-serif; }
        .footer-links a:hover { opacity: 0.7; }
        .social-icons { display: flex; gap: 15px; }
        .social-icons a { background: rgba(255,255,255,0.2); border-radius: 50%; border: 2px solid white; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; transition: all 0.3s ease; }
        .social-icons a:hover { background: white; transform: scale(1.1); }
        .social-icons a svg { width: 20px; height: 20px; fill: white; }
        .social-icons a:hover svg { fill: #4a5f9d; }
        @media (max-width: 768px) {
            header { height: auto; padding: 16px; }
            .logo img { width: 80px; height: 80px; }
            nav ul { flex-wrap: wrap; gap: 12px; }
            .faculty-profile { flex-direction: column; text-align: center; gap: 16px; }
            .profile-left { flex-direction: column; }
            .profile-actions { flex-direction: column; }
            .dashboard-actions { grid-template-columns: 1fr; }
            .modal-content { width: 95%; max-height: 95vh; }
            .modal-header, .modal-body, .modal-actions { padding: 20px; }
            .modal-actions { flex-direction: column; }
            footer { flex-direction: column; gap: 16px; text-align: center; }
        }
    </style>
</head>
<body>
    <header>
        <div class="logo">
            <a href="homepage.html">
                <img src="images/school/logo.png" alt="PGES Logo"/>
            </a>
        </div>
        <div class="header-text">
            <h1>Republic of the Philippines</h1>
            <h2>Pedro Guevara Elementary School E-Library</h2>
            <p>San Nicolas, Manila</p>
        </div>
    </header>

    <nav>
        <ul>
            <li><a href="homepage.html">HOMEPAGE</a></li>
            <li><a href="facultydashboard.html">DASHBOARD</a></li>
            <li class="dropdown">
                <a class="dropdown-toggle" onclick="toggleDropdown()">
                    BOOKS
                    <span class="arrow">▼</span>
                </a>
                <div class="dropdown-menu" id="booksMenu">
                    <a href="grade1books.html">Grade 1</a>
                    <a href="grade2books.html">Grade 2</a>
                    <a href="grade3books.html">Grade 3</a>
                    <a href="grade4books.html">Grade 4</a>
                    <a href="grade5books.html">Grade 5</a>
                    <a href="grade6books.html">Grade 6</a>
                    <a href="otherbooks.html">Other Books</a>
                </div>
            </li>
            <li style="flex:1;"></li>
            <li>
                <form class="search-form" onsubmit="handleSearch(event)">
                    <input type="text" name="search" placeholder="Search books..." class="search-input" id="searchInput">
                    <button type="submit" class="search-btn">Search</button>
                </form>
            </li>
            <li>
                <button class="logout-btn" onclick="handleLogout()">Log Out</button>
            </li>
        </ul>
    </nav>

    <main>
        <section class="faculty-profile">
            <div class="profile-left">
                <div class="faculty-avatar" id="facultyAvatar">M</div>
                <div class="faculty-info">
                    <h2 id="faculty-name">Maria Clara Santos</h2>
                    <p id="faculty-department">Faculty ID: FAC-12345 | Department: Mathematics</p>
                </div>
            </div>
            <div class="profile-actions">
                <button class="edit-info-btn" onclick="openEditModal()">✏️ Edit Info</button>
                <div class="greeting-message" id="greeting">Good Day!</div>
            </div>
        </section>

        <section class="dashboard-actions">
            <div class="action-card" onclick="window.location.href='borrowed-books.html'">
                <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path d="M18 2H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zM6 4h5v8l-2.5-1.5L6 12V4z"/>
                </svg>
                <h3>Borrowed Books</h3>
                <p>View all books you currently have</p>
            </div>

            <div class="action-card" onclick="window.location.href='borrowing-history.html'">
                <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path d="M13 3c-4.97 0-9 4.03-9 9H1l3.89 3.89.07.14L9 12H6c0-3.87 3.13-7 7-7s7 3.13 7 7-3.13 7-7 7c-1.93 0-3.68-.79-4.94-2.06l-1.42 1.42C8.27 19.99 10.51 21 13 21c4.97 0 9-4.03 9-9s-4.03-9-9-9zm-1 5v5l4.28 2.54.72-1.21-3.5-2.08V8H12z"/>
                </svg>
                <h3>Borrowing History</h3>
                <p>Check your borrowing records</p>
            </div>

            <div class="action-card" onclick="window.location.href='returned-books.html'">
                <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path d="M9 11H7v2h2v-2zm4 0h-2v2h2v-2zm4 0h-2v2h2v-2zm2-7h-1V2h-2v2H8V2H6v2H5c-1.11 0-1.99.9-1.99 2L3 20c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 16H5V9h14v11z"/>
                </svg>
                <h3>Returned Books</h3>
                <p>View your returned books</p>
            </div>
        </section>
    </main>

    <div id="editInfoModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Edit Your Information</h2>
                <button class="close-btn" onclick="closeEditModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="editInfoForm">
                    <div class="form-group">
                        <label>Username</label>
                        <input type="text" id="editUsername" disabled>
                        <p class="form-note">Username cannot be changed</p>
                    </div>
                    <div class="form-group">
                        <label>Full Name</label>
                        <input type="text" id="editName" placeholder="Enter your full name">
                    </div>
                    <div class="form-group">
                        <label>Faculty ID</label>
                        <input type="text" id="editFacultyId" placeholder="e.g., FAC-12345">
                    </div>
                    <div class="form-group">
                        <label>Department</label>
                        <select id="editDepartment">
                            <option value="">Select Department</option>
                            <option value="Mathematics">Mathematics</option>
                            <option value="Science">Science</option>
                            <option value="English">English</option>
                            <option value="Filipino">Filipino</option>
                            <option value="MAPEH">MAPEH</option>
                            <option value="Araling Panlipunan">Araling Panlipunan</option>
                            <option value="Values Education">Values Education</option>
                            <option value="Technology and Livelihood Education">Technology and Livelihood Education</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Email Address</label>
                        <input type="email" id="editEmail" placeholder="e.g., faculty@pges.edu.ph">
                    </div>
                    <div class="form-group">
                        <label>New Password</label>
                        <input type="password" id="editPassword" placeholder="Leave blank to keep current password">
                        <p class="form-note">Minimum 6 characters</p>
                    </div>
                    <div class="form-group">
                        <label>Confirm New Password</label>
                        <input type="password" id="editPasswordConfirm" placeholder="Confirm new password">
                    </div>
                </form>
            </div>
            <div class="modal-actions">
                <button class="btn-save" onclick="saveEditInfo()">Save Changes</button>
                <button class="btn-cancel" onclick="closeEditModal()">Cancel</button>
            </div>
        </div>
    </div>

    <footer>
        <div><p>2025 PGES All rights reserved.</p></div>
        <div class="footer-links">
            <a href="privacy-policy.html">Privacy Policy</a>
            <a href="terms-of-use.html">Terms of Use</a>
        </div>
        <div class="social-icons">
            <a href="https://www.facebook.com/pedroguevaramanila" title="Facebook">
                <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/></svg>
            </a>
            <a href="https://www.instagram.com/pedroguevaraelementaryschool/" title="Instagram">
                <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/></svg>
            </a>
        </div>
    </footer>

    <script>
        window.addEventListener('DOMContentLoaded', function() {
            loadUserProfile();
            
            const facultyData = JSON.parse(localStorage.getItem('facultyData') || '{}');
            if (!facultyData.username) {
                const defaultData = {
                    username: 'faculty',
                    name: 'Maria Clara Santos',
                    facultyId: 'FAC-12345',
                    department: 'Mathematics',
                    email: '',
                    password: 'faculty123'
                };
                localStorage.setItem('facultyData', JSON.stringify(defaultData));
                loadUserProfile();
            }
        });

        function loadUserProfile() {
            const facultyData = JSON.parse(localStorage.getItem('facultyData') || '{}');       
            
            if (facultyData.name) {
                document.getElementById('faculty-name').textContent = facultyData.name;
                const firstName = facultyData.name.split(' ')[0];
                document.getElementById('facultyAvatar').textContent = firstName.charAt(0).toUpperCase();
                updateGreeting(firstName);
            } else {
                document.getElementById('faculty-name').textContent = 'Faculty Member';
                document.getElementById('facultyAvatar').textContent = 'F';
                updateGreeting('Faculty');
            }
            
            const facultyId = facultyData.facultyId || 'FAC-12345';
            const department = facultyData.department || 'Not Set';
            document.getElementById('faculty-department').textContent = `Faculty ID: ${facultyId} | Department: ${department}`;
        }

        function openEditModal() {
            const facultyData = JSON.parse(localStorage.getItem('facultyData') || '{}');
            document.getElementById('editUsername').value = facultyData.username || 'Not Set';
            document.getElementById('editName').value = facultyData.name || '';
            document.getElementById('editFacultyId').value = facultyData.facultyId || '';
            
            const departmentSelect = document.getElementById('editDepartment');
            if (facultyData.department) {
                departmentSelect.value = facultyData.department;
            } else {
                departmentSelect.value = '';
            }
            
            document.getElementById('editEmail').value = facultyData.email || '';
            
            document.getElementById('editPassword').value = '';
            document.getElementById('editPasswordConfirm').value = '';
            
            document.getElementById('editInfoModal').classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closeEditModal() {
            document.getElementById('editInfoModal').classList.remove('active');
            document.body.style.overflow = 'auto';
        }

        function saveEditInfo() {
            const name = document.getElementById('editName').value.trim();
            const facultyId = document.getElementById('editFacultyId').value.trim();
            const department = document.getElementById('editDepartment').value;
            const email = document.getElementById('editEmail').value.trim();
            const password = document.getElementById('editPassword').value;
            const passwordConfirm = document.getElementById('editPasswordConfirm').value;

            if (email && !validateEmail(email)) {
                alert('Please enter a valid email address.');
                return;
            }

            if (password && password.length < 6) {
                alert('Password must be at least 6 characters long.');
                return;
            }

            if (password && password !== passwordConfirm) {
                alert('Passwords do not match!');
                return;
            }
            const facultyData = JSON.parse(localStorage.getItem('facultyData') || '{}');
            
            let changesMade = false;
            
            if (name && name !== facultyData.name) {
                facultyData.name = name;
                changesMade = true;
            }
            if (facultyId && facultyId !== facultyData.facultyId) {
                facultyData.facultyId = facultyId;
                changesMade = true;
            }
            if (department && department !== facultyData.department) {
                facultyData.department = department;
                changesMade = true;
            }
            if (email && email !== facultyData.email) {
                facultyData.email = email;
                changesMade = true;
            }
            if (password) {
                facultyData.password = password;
                changesMade = true;
            }

            if (!changesMade) {
                alert('No changes were made.');
                closeEditModal();
                return;
            }

            localStorage.setItem('facultyData', JSON.stringify(facultyData));
            console.log('Saved facultyData:', facultyData); 

            const systemUsers = JSON.parse(localStorage.getItem('systemUsers') || '[]');
            const userIndex = systemUsers.findIndex(u => u.username === facultyData.username);
            
            if (userIndex !== -1) {
                if (name) systemUsers[userIndex].name = name;
                if (department) systemUsers[userIndex].department = department;
                if (facultyId) systemUsers[userIndex].facultyId = facultyId;
                if (email) systemUsers[userIndex].email = email;
                if (password) systemUsers[userIndex].password = password;
                localStorage.setItem('systemUsers', JSON.stringify(systemUsers));
                console.log('Updated systemUsers'); 
            }

            loadUserProfile();
            closeEditModal();
            
            alert('Your information has been updated successfully!');
        }

        function validateEmail(email) {
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return emailRegex.test(email);
        }

        function updateGreeting(firstName) {
            const hour = new Date().getHours();
            let greeting;
            
            if (hour >= 5 && hour < 12) {
                greeting = 'Good Morning';
            } else if (hour >= 12 && hour < 18) {
                greeting = 'Good Afternoon';
            } else {
                greeting = 'Good Evening';
            }
            
            document.getElementById('greeting').textContent = `${greeting}, ${firstName}!`;
        }

        function toggleDropdown() {
            const menu = document.getElementById('booksMenu');
            const dropdown = document.querySelector('.dropdown');
            
            menu.classList.toggle('show');
            dropdown.classList.toggle('active');
        }

        function handleLogout() {
            if (confirm('Are you sure you want to log out?')) {
                localStorage.removeItem('isLoggedIn');
                localStorage.removeItem('userType');
                localStorage.removeItem('facultyData');
                sessionStorage.removeItem('userType');
                alert('You have been logged out successfully!');
                window.location.href = 'faculty-login.html';
            }
        }

        function handleSearch(event) {
            event.preventDefault();
            const searchInput = document.getElementById('searchInput');
            const query = searchInput.value.trim();
            
            if (query) {
                alert('Searching for: ' + query + '\n\nSearch functionality will be fully implemented soon!');
                searchInput.value = '';
            } else {
                alert('Please enter a search term');
            }
        }

        document.addEventListener('click', function(event) {
            const booksMenu = document.getElementById('booksMenu');
            const dropdown = document.querySelector('.dropdown');
            const dropdownBtn = event.target.closest('.dropdown-toggle');
            
            if (!dropdownBtn && booksMenu) {
                booksMenu.classList.remove('show');
                if (dropdown) dropdown.classList.remove('active');
            }
        });

        window.onclick = function(event) {
            const editModal = document.getElementById('editInfoModal');
            if (event.target === editModal) {
                closeEditModal();
            }
        }

        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                closeEditModal();
            }
        });
    </script>
</body>
</html>