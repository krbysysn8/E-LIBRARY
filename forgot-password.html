<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;700&family=Open+Sans:wght@400;700&display=swap" rel="stylesheet">
    <title>Forgot Password - Reset Password | Pedro Guevara Elementary School E-Library</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        .error-message {
            color: red;           
            font-size: 0.85em;         
            margin-left: 10px; 
            display: inline-block; 
            margin-top: 0;
            margin-bottom: 0;
        }

        .label-container {
            display: flex;
            justify-content: space-between; 
            align-items: center;
            margin-bottom: 4px; 
        }

        .label-container label {
            margin-bottom: 0; 
        }

        body.forgot-password .login-card-form {
            height: 600px !important;
            padding: 2rem 2rem !important;
        }

        body.forgot-password .login-image {
            height: 600px !important;
        }

        body.forgot-password .input-icon {
            margin-bottom: 0.8rem !important;
            padding: 0.4rem 1rem !important;
        }

        @keyframes iconFloat {
            0%, 100% { transform: translateY(-50%) translateY(0); }
            50% { transform: translateY(-50%) translateY(-10px); }
        }

        body.forgot-password .login-card-form h3::before {
            content: 'ðŸ”’';
            position: absolute;
            right: 20px !important; 
            top: 50% !important;
            transform: translateX(-50%);
            font-size: 50px;
            left: auto !important;
            animation: iconFloat 3s ease-in-out infinite;
        }

        body.forgot-password .login-card-form h3 {
            padding-right: 60px !important; 
            text-align: center !important;
            padding-top: 0 !important;
            margin-bottom: 1.5rem !important;
            position: relative;
        }

        body.forgot-password .label-container {
            margin-bottom: 0.3rem !important;
        }

        body.forgot-password .login-btn {
            padding: 0.8rem 0 !important;
            margin-top: 1rem !important;
            font-size: 1rem !important;
        }

        body.forgot-password .forgot-link {
            margin-top: 0.8rem !important;
        }

        body.forgot-password .input-icon input,
        body.forgot-password .input-icon select {
            padding: 0.6rem 0 !important;
            font-size: 1rem !important;
        }

        body.forgot-password .input-icon .icon img {
            width: 20px !important;
            height: 20px !important;
        }

        .security-question-text {
            background: linear-gradient(135deg, #f0f4ff 0%, #e8eeff 100%);
            padding: 15px 18px;
            border-radius: 12px;
            border: 2px solid #d0dcff;
            color: #4a5f9d;
            font-family: 'Fredoka', Arial, sans-serif;
            font-weight: 600;
            font-size: 0.95rem;
            margin-bottom: 1rem;
            text-align: center;
        }
.faq-modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(44, 62, 80, 0.5);
    z-index: 9999;
    transition: opacity 0.3s ease;
}
.faq-modal.show {
    display: block;
}
.faq-popup {
    background: linear-gradient(135deg, #f8faff 0%, #e8f2ff 100%);
    width: 450px;
    max-width: 95vw;
    position: fixed;
    right: 0;
    transform: translateX(100%);
    box-shadow: -8px 0 32px rgba(74, 95, 157, 0.25);
    border-top-left-radius: 32px;
    border-bottom-left-radius: 32px;
    transition: transform 0.4s cubic-bezier(0.68, -0.55, 0.27, 1.55);
    display: flex;
    flex-direction: column;
    z-index: 10000;
    overflow: hidden;
    min-height: 200px;
}
.faq-modal.slide-in .faq-popup {
    transform: translateX(0);
}
.faq-close-btn {
    position: absolute;
    top: 20px;
    right: 20px;
    background: #4a5f9d;
    color: #fff;
    border: none;
    border-radius: 50%;
    width: 40px;
    height: 40px;
    font-size: 1.5rem;
    line-height: 1;
    cursor: pointer;
    box-shadow: 0 4px 12px rgba(74, 95, 157, 0.3);
    transition: all 0.3s ease;
    z-index: 10;
    display: flex;
    align-items: center;
    justify-content: center;
}
.faq-close-btn:hover {
    background: #6b82c5;
    transform: rotate(90deg) scale(1.1);
}
.faq-title {
    font-family: 'Fredoka', Arial, sans-serif;
    font-size: 1.8rem;
    color: #4a5f9d;
    font-weight: 800;
    text-align: center;
    margin: 0;
    padding: 30px 60px 20px 30px;
    letter-spacing: 0.5px;
    flex-shrink: 0;
    border-bottom: 2px solid rgba(74, 95, 157, 0.1);
}
.faq-list {
    flex: 1;
    overflow-y: auto;
    overflow-x: hidden;
    padding: 20px 30px 30px 30px;
}
.faq-list::-webkit-scrollbar {
    width: 8px;
}
.faq-list::-webkit-scrollbar-track {
    background: rgba(74, 95, 157, 0.05);
    border-radius: 10px;
}
.faq-list::-webkit-scrollbar-thumb {
    background: rgba(74, 95, 157, 0.3);
    border-radius: 10px;
}
.faq-list::-webkit-scrollbar-thumb:hover {
    background: rgba(74, 95, 157, 0.5);
}
.faq-popup .faq {
    border-bottom: 1px solid #e0e7ff;
    padding: 18px 0;
    cursor: pointer;
    transition: all 0.2s ease;
}
.faq-popup .faq:last-child {
    border-bottom: none;
}
.faq-popup .faq:hover {
    background: rgba(107, 130, 197, 0.05);
    padding-left: 10px;
    padding-right: 10px;
    margin-left: -10px;
    margin-right: -10px;
    border-radius: 8px;
}
.faq-popup .question {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    gap: 15px;
    font-weight: bold;
    color: #4a5f9d;
    font-size: 1.05rem;
    font-family: 'Fredoka', Arial, sans-serif;
}
.faq-popup .question span:first-child {
    flex: 1;
}
.faq-popup .question span:last-child {
    flex-shrink: 0;
    font-size: 1.5rem;
    transition: transform 0.3s ease, color 0.3s ease;
    width: 24px;
    height: 24px;
    display: flex;
    align-items: center;
    justify-content: center;
}
.faq-popup .answer {
    display: none;
    padding-top: 12px;
    padding-left: 5px;
    color: #444;
    line-height: 1.7;
    font-family: 'Open Sans', Arial, sans-serif;
    font-size: 0.95rem;
}
.faq-popup .answer ol,
.faq-popup .answer ul {
    margin: 10px 0;
    padding-left: 25px;
}
.faq-popup .answer li {
    margin: 8px 0;
}
.faq-popup .answer p {
    margin: 10px 0;
}
.faq-popup .answer strong {
    color: #4a5f9d;
    font-weight: 700;
}
.faq-popup .answer a {
    color: #4a5f9d;
    text-decoration: underline;
    transition: color 0.2s ease;
}
.faq-popup .answer a:hover {
    color: #6b82c5;
}
.faq-popup .faq.active .answer {
    display: block;
    animation: slideDown 0.3s ease-out;
}
@keyframes slideDown {
    from {
        opacity: 0;
        transform: translateY(-10px);
        max-height: 0;
    }
    to {
        opacity: 1;
        transform: translateY(0);
        max-height: 500px;
    }
}
.faq-popup .faq.active .question span:last-child {
    transform: rotate(45deg);
    color: #6b82c5;
}
@media (max-width: 768px) {
    .faq-popup {
        width: 380px;
        top: 192px;
    }
    .faq-title {
        font-size: 1.5rem;
        padding: 25px 50px 18px 25px;
    }
    .faq-list {
        padding: 15px 25px 25px 25px;
    }
}
@media (max-width: 600px) {
    .faq-popup {
        width: 100vw;
        max-width: 100vw;
        border-radius: 0;
        top: 192px;
    }
    .faq-title {
        font-size: 1.4rem;
        padding: 20px 50px 15px 20px;
    }
    .faq-list {
        padding: 15px 20px 20px 20px;
    }
    .faq-close-btn {
        width: 36px;
        height: 36px;
        font-size: 1.3rem;
        top: 15px;
        right: 15px;
    }
    .faq-popup .question {
        font-size: 1rem;
    }
    .faq-popup .answer {
        font-size: 0.9rem;
    }
}
    </style>
</head>
<body class="forgot-password">
    <header>
        <div class="logo">
            <a href="homepage.html" aria-label="Go to Homepage">
                <img src="images/school/logo.png" alt="PGES Logo"/>
            </a>
        </div>
        <div class="header-text">
            <h1>Republic of the Philippines</h1>
            <h2>Pedro Guevara Elementary School E-Library</h2>
            <p>San Nicolas, Manila</p>
        </div>
    </header>
    <nav>
        <ul>
            <li><a href="homepage.html">HOMEPAGE</a></li>
            <li><a href="about.html">ABOUT US</a></li>
            <li><a href="#" id="openFaqBtn">FAQ</a></li>
        </ul>
    </nav>

    <main class="login-main">
        <div class="login-flex">
            <div class="login-card-form">
                <h3>Reset Your Password</h3>
                
                <div class="security-question-text" id="security-question-display">
            
                </div>

                <form id="resetForm">
                    <div class="label-container">
                        <label for="security-answer">Your Answer</label>
                        <span class="error-message" id="answer-error"></span>
                    </div>
                    <div class="input-icon">
                        <span class="icon">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" style="width:20px;height:20px;vertical-align:middle;fill:#4a5f9d;"><path d="M400 416C497.2 416 576 337.2 576 240C576 142.8 497.2 64 400 64C302.8 64 224 142.8 224 240C224 258.7 226.9 276.8 232.3 293.7L71 455C66.5 459.5 64 465.6 64 472L64 552C64 565.3 74.7 576 88 576L168 576C181.3 576 192 565.3 192 552L192 512L232 512C245.3 512 256 501.3 256 488L256 448L296 448C302.4 448 308.5 445.5 313 441L346.3 407.7C363.2 413.1 381.3 416 400 416zM440 160C462.1 160 480 177.9 480 200C480 222.1 462.1 240 440 240C417.9 240 400 222.1 400 200C400 177.9 417.9 160 440 160z"/></svg>
                        </span>
                        <input id="security-answer" type="text" placeholder="Enter your answer" required>
                    </div>

                    <div class="label-container">
                        <label for="new-password">New Password</label>
                        <span class="error-message" id="password-error"></span>
                    </div>
                    <div class="input-icon">
                        <span class="icon">
                            <img src="images/school/lock.png" alt="Lock Icon" />
                        </span>
                        <input id="new-password" type="password" placeholder="Enter new password" required>
                        <button type="button" class="show-btn" onclick="togglePassword('new-password', this)">Show</button>
                    </div>

                    <div class="label-container">
                        <label for="confirm-password">Confirm New Password</label>
                    </div>
                    <div class="input-icon">
                        <span class="icon">
                            <img src="images/school/lock.png" alt="Lock Icon" />
                        </span>
                        <input id="confirm-password" type="password" placeholder="Confirm new password" required>
                        <button type="button" class="show-btn" onclick="togglePassword('confirm-password', this)">Show</button>
                    </div>

                    <button type="submit" class="login-btn">Reset Password</button>
                </form>

                <div class="forgot-link">
                    <a href="#" id="back-to-login">Back to Login</a>
                </div>
            </div>

            <div class="login-image">
                <img src="images/school/school.jpg" alt="Pedro Guevara Elementary School" />
            </div>
        </div>

        <div id="faqModal" class="faq-modal">
            <div class="faq-popup">
                <button id="closeFaqModal" class="faq-close-btn" title="Close FAQ">&times;</button>
                <h2 class="faq-title">Frequently Asked Questions</h2>
                <div class="faq-list">
                    <div class="faq">
                        <div class="question"><span>Who can access the E-Library?</span><span>+</span></div>
                        <div class="answer">Only registered students and teachers of Pedro Guevara Elementary School are authorized to access the e-library website.</div>
                    </div>
                    <div class="faq">
                        <div class="question"><span>How do I borrow books through the e-library?</span><span>+</span></div>
                        <div class="answer">
                            To borrow a book:
                            <ol>
                                <li>Log in to the e-library system.</li>
                                <li>Click the "Borrow" button next to your chosen book.</li>
                                <li>Present your school ID to the librarian to receive the physical copy.</li>
                            </ol>
                        </div>
                    </div>
                    <div class="faq">
                        <div class="question"><span>How long can I borrow books?</span><span>+</span></div>
                        <div class="answer">
                            <ul>
                                <li>Students may borrow books for up to <strong>7 days</strong> from the date of borrowing.</li>
                                <li>Teachers may borrow books for up to <strong>14 days</strong> from the date of borrowing.</li>
                            </ul>
                            <p>Please borrow and return books responsibly.</p>
                        </div>
                    </div>
                    <div class="faq">
                        <div class="question"><span>Are there online copies of books available?</span><span>+</span></div>
                        <div class="answer">Yes, some books have digital versions that can be accessed directly through the website. Others are available only in physical format.</div>
                    </div>
                    <div class="faq">
                        <div class="question"><span>How can I contact the library for help?</span><span>+</span></div>
                        <div class="answer">
                            You can reach out in two ways:
                            <ol>
                                <li>Message us via our official Facebook page: <a href="https://www.facebook.com/pedroguevaramanila" target="_blank">[Facebook Page Link]</a></li>
                                <li>Visit the library and speak with the librarian during library hours (8 AM - 3 PM).</li>
                            </ol>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <footer>
        <div>
            <p>2025 PGES All rights reserved.</p>
        </div>
        <div class="footer-links">
            <a href="privacy-policy.html">Privacy Policy</a>
            <a href="terms-of-use.html">Terms of Use</a>
        </div>
        <div class="social-icons">
            <a href="https://www.facebook.com/pedroguevaramanila" title="Facebook">
                <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/>
                </svg>
            </a>
            <a href="https://www.instagram.com/pedroguevaraelementaryschool/" title="Instagram">
                <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/>
                </svg>
            </a>
        </div>
    </footer>

    <script>
        function togglePassword(id, btn) {
            const input = document.getElementById(id);
            if (!input) return;
            if (input.type === 'password') {
                input.type = 'text';
                btn.textContent = 'Hide';
            } else {
                input.type = 'password';
                btn.textContent = 'Show';
            }
        }

        function getUserType() {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get('type') || 'student';
        }

        function redirectToLogin(userType) {
            switch(userType) {
                case 'student':
                    window.location.href = 'student-login.html';
                    break;
                case 'faculty':
                    window.location.href = 'faculty-login.html';
                    break;
                case 'admin':
                    window.location.href = 'admin-login.html';
                    break;
                default:
                    window.location.href = 'login-dashboard.html';
                    break;
            }
        }

        const securityQuestions = {
            'nickname': 'What is the nickname that only your family uses for you?',
            'firstcrush': 'What was the name of your first crush?',
            'favoritesong': 'What is your favorite song?',
            'firstpet': 'What was the name of your first pet?',
            'mothermaiden': 'What is your mother\'s maiden name?',
            'birthcity': 'What is the name of the city/town where you were born?',
            'childhoodfriend': 'What is the name of your favorite childhood friend?',
            'foodhate': 'What food do you hate the most (not just dislike)?',
            'firstcity': 'What city did you first work or study in away from home?'
        };

        document.addEventListener('DOMContentLoaded', function() {
            const userType = getUserType();
            const backLink = document.getElementById('back-to-login');
            const verificationData = sessionStorage.getItem('forgotPasswordVerification');
            if (!verificationData) {
                alert('Session expired. Please start over.');
                window.location.href = `forgot-password.html?type=${userType}`;
                return;
            }
            const verification = JSON.parse(verificationData);
            if (!verification.verified || verification.userType !== userType) {
                alert('Invalid session. Please start over.');
                window.location.href = `forgot-password.html?type=${userType}`;
                return;
            }
            const questionDisplay = document.getElementById('security-question-display');
            const questionText = securityQuestions[verification.securityQuestion] || verification.securityQuestion;
            questionDisplay.textContent = questionText;
            switch(userType) {
                case 'student':
                    backLink.textContent = 'Back to Student Login';
                    break;
                case 'faculty':
                    backLink.textContent = 'Back to Faculty Login';
                    break;
                case 'admin':
                    backLink.textContent = 'Back to Admin Login';
                    break;
            }
            backLink.addEventListener('click', function(e) {
                e.preventDefault();
                sessionStorage.removeItem('forgotPasswordVerification');
                redirectToLogin(userType);
            });
            document.getElementById('resetForm').addEventListener('submit', function(e) {
                e.preventDefault();
                const securityAnswer = document.getElementById('security-answer').value.trim();
                const newPassword = document.getElementById('new-password').value;
                const confirmPassword = document.getElementById('confirm-password').value;
                const answerError = document.getElementById('answer-error');
                const passwordError = document.getElementById('password-error');
                answerError.textContent = '';
                passwordError.textContent = '';
                if (securityAnswer.toLowerCase() !== verification.securityAnswer.toLowerCase()) {
                    answerError.textContent = 'Incorrect answer';
                    return;
                }
                if (newPassword.length < 6) {
                    passwordError.textContent = 'Password must be at least 6 characters';
                    return;
                }
                if (newPassword !== confirmPassword) {
                    passwordError.textContent = 'Passwords do not match';
                    return;
                }
                let registeredUsers = [];
                let storageKey = '';
                if (userType === 'student') {
                    storageKey = 'registeredStudents';
                    registeredUsers = JSON.parse(localStorage.getItem(storageKey) || '[]');
                    const userIndex = registeredUsers.findIndex(u => 
                        u.username.toLowerCase() === verification.username.toLowerCase()
                    );
                    if (userIndex !== -1) {
                        registeredUsers[userIndex].password = newPassword;
                    }
                } else if (userType === 'faculty') {
                    storageKey = 'registeredFaculty';
                    registeredUsers = JSON.parse(localStorage.getItem(storageKey) || '[]');
                    const userIndex = registeredUsers.findIndex(u => 
                        u.facultyId === verification.username
                    );
                    if (userIndex !== -1) {
                        registeredUsers[userIndex].password = newPassword;
                    }
                } else {
                    storageKey = 'registeredAdmins';
                    registeredUsers = JSON.parse(localStorage.getItem(storageKey) || '[]');
                    const userIndex = registeredUsers.findIndex(u => 
                        u.adminId === verification.username
                    );
                    if (userIndex !== -1) {
                        registeredUsers[userIndex].password = newPassword;
                    }
                }
                localStorage.setItem(storageKey, JSON.stringify(registeredUsers));
                sessionStorage.removeItem('forgotPasswordVerification');
                alert('Password successfully changed! You can now login with your new password.');
                redirectToLogin(userType);
            });
            const faqBtn = document.getElementById('openFaqBtn');
            const faqModal = document.getElementById('faqModal');
            const faqClose = document.getElementById('closeFaqModal');
            const faqPopup = faqModal ? faqModal.querySelector('.faq-popup') : null;
            if (!faqBtn || !faqModal || !faqClose || !faqPopup) {
                console.error('FAQ elements not found');
                return;
            }
            function adjustFaqModalPosition() {
                const nav = document.querySelector('nav');
                const footer = document.querySelector('footer');
                if (!nav || !footer) return;
                const navRect = nav.getBoundingClientRect();
                const footerRect = footer.getBoundingClientRect();
                const topPosition = navRect.bottom;
                const bottomPosition = window.innerHeight - footerRect.top;
                const availableHeight = footerRect.top - navRect.bottom;
                faqPopup.style.top = topPosition + 'px';
                faqPopup.style.bottom = bottomPosition + 'px';
                faqPopup.style.maxHeight = availableHeight + 'px';
                faqPopup.style.height = availableHeight + 'px';
            }
            faqBtn.addEventListener('click', function(e) {
                e.preventDefault();
                faqModal.classList.add('show');
                setTimeout(() => {
                    faqModal.classList.add('slide-in');
                    adjustFaqModalPosition();
                }, 10);
                document.body.style.overflow = 'hidden';
            });
            function closeFaqModal() {
                faqModal.classList.remove('slide-in');
                setTimeout(() => {
                    faqModal.classList.remove('show');
                    document.body.style.overflow = '';
                }, 350);
            }
            faqClose.addEventListener('click', function(e) {
                e.stopPropagation();
                closeFaqModal();
            });
            faqModal.addEventListener('click', function(e) {
                if (e.target === faqModal) {
                    closeFaqModal();
                }
            });
            if (faqPopup) {
                faqPopup.addEventListener('click', function(e) {
                    e.stopPropagation();
                });
            }
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape' && faqModal.classList.contains('show')) {
                    closeFaqModal();
                }
            });
            const faqItems = document.querySelectorAll('.faq-popup .faq');
            faqItems.forEach(faq => {
                const question = faq.querySelector('.question');
                if (question) {
                    question.addEventListener('click', function(e) {
                        e.stopPropagation();
                        faqItems.forEach(otherFaq => {
                            if (otherFaq !== faq && otherFaq.classList.contains('active')) {
                                otherFaq.classList.remove('active');
                            }
                        });
                        faq.classList.toggle('active');
                    });
                }
            });
            window.addEventListener('scroll', function() {
                if (faqModal.classList.contains('show')) {
                    adjustFaqModalPosition();
                }
            });
            window.addEventListener('resize', function() {
                if (faqModal.classList.contains('show')) {
                    adjustFaqModalPosition();
                }
            });
        });
    </script>
</body>
</html> 